<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Correlation Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        .time-btn { transition: all 0.2s; }
        .time-btn.active { background: #3b82f6; transform: scale(1.05); }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <div class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold mb-2">Stock Correlation Dashboard</h1>
            <p class="text-slate-300 text-sm md:text-base">Real-time Social, Options, and Price Analysis</p>
        </div>

        <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-6 mb-6">
            <div class="flex gap-3 md:gap-4 items-end flex-wrap">
                <div class="flex-1 min-w-48">
                    <label class="block text-sm font-semibold mb-2">Stock Symbol</label>
                    <input 
                        type="text"
                        id="symbolInput"
                        placeholder="Enter symbol (IREN, TSLA, NVDA)"
                        class="w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-blue-500"
                        value="IREN"
                    />
                </div>
                <button onclick="searchSymbol()" class="px-6 md:px-8 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-all">
                    Analyze
                </button>
                <button onclick="refreshData()" id="refreshBtn" class="px-6 md:px-8 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition-all flex items-center gap-2">
                    <span id="refreshIcon">ðŸ”„</span>
                    <span class="hidden md:inline">Refresh</span>
                </button>
            </div>
        </div>

        <div class="bg-gradient-to-r from-blue-900 to-purple-900 border-2 border-blue-700 rounded-lg p-4 md:p-6 mb-6">
            <div class="flex justify-between items-start flex-wrap gap-4">
                <div class="flex-1">
                    <p class="text-xs md:text-sm opacity-90 mb-1">NOW ANALYZING</p>
                    <p class="text-3xl md:text-4xl font-bold" id="currentSymbol">IREN</p>
                    <p class="text-sm md:text-base opacity-90 mt-1" id="companyName">IREN Limited</p>
                    <p class="text-xs md:text-sm opacity-90 mt-2" id="lastUpdate">Loading...</p>
                    <p class="text-xs opacity-75 mt-1" id="dataStatus">Using demo data</p>
                </div>
                <div class="text-right">
                    <p class="text-4xl md:text-6xl font-bold opacity-50" id="signalScore">75</p>
                    <p class="text-xs md:text-sm opacity-90">Correlation Score</p>
                    <p class="text-base md:text-lg font-bold mt-2" id="signalStrength">MODERATE BUY</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3 mb-6">
            <div class="bg-slate-800 border border-slate-700 rounded-lg p-3">
                <p class="text-xs text-slate-400 mb-1">Current Price</p>
                <p class="text-xl md:text-2xl font-bold" id="price">$64.14</p>
                <p class="text-xs mt-1 text-green-400" id="priceChange">+4.37 (+7.31%)</p>
            </div>

            <div class="bg-slate-800 border border-slate-700 rounded-lg p-3">
                <p class="text-xs text-slate-400 mb-1">52W High</p>
                <p class="text-xl md:text-2xl font-bold text-green-400" id="week52High">$70.05</p>
                <p class="text-xs mt-1 text-slate-500" id="highDistance">-8.4%</p>
            </div>

            <div class="bg-slate-800 border border-slate-700 rounded-lg p-3">
                <p class="text-xs text-slate-400 mb-1">52W Low</p>
                <p class="text-xl md:text-2xl font-bold text-red-400" id="week52Low">$5.17</p>
                <p class="text-xs mt-1 text-slate-500" id="lowDistance">+1140%</p>
            </div>

            <div class="bg-slate-800 border border-slate-700 rounded-lg p-3">
                <p class="text-xs text-slate-400 mb-1">YTD Change</p>
                <p class="text-xl md:text-2xl font-bold text-green-400" id="ytdChange">+487%</p>
                <p class="text-xs mt-1 text-slate-500" id="volume">Vol: 47.0M</p>
            </div>

            <div class="bg-slate-800 border border-slate-700 rounded-lg p-3">
                <p class="text-xs text-slate-400 mb-1">Next Earnings</p>
                <p class="text-lg md:text-xl font-bold" id="earningsDate">Dec 2</p>
                <p class="text-xs mt-1 text-slate-500" id="earningsTime">23 days</p>
            </div>

            <div class="bg-slate-800 border border-slate-700 rounded-lg p-3">
                <p class="text-xs text-slate-400 mb-1">Market Cap</p>
                <p class="text-lg md:text-xl font-bold" id="marketCap">$16.2B</p>
                <p class="text-xs mt-1 text-slate-500" id="sector">Technology</p>
            </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
            <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-5">
                <p class="text-xs md:text-sm text-slate-400 mb-2">Social Mentions (24h)</p>
                <p class="text-2xl md:text-3xl font-bold text-blue-400" id="socialMentions">107</p>
                <p class="text-sm mt-1 text-blue-300" id="socialTrend">Rising</p>
                <p class="text-xs text-slate-500 mt-2">Reddit + Twitter</p>
            </div>

            <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-5">
                <p class="text-xs md:text-sm text-slate-400 mb-2">Put/Call Ratio</p>
                <p class="text-2xl md:text-3xl font-bold text-purple-400" id="putCallRatio">0.86</p>
                <p class="text-sm mt-1 text-green-400" id="optionsSentiment">Bullish</p>
                <p class="text-xs text-slate-500 mt-2">Below 1.0 is bullish</p>
            </div>

            <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-5">
                <p class="text-xs md:text-sm text-slate-400 mb-2">Options Activity</p>
                <p class="text-2xl md:text-3xl font-bold text-yellow-400" id="unusualActivity">Moderate</p>
                <p class="text-sm mt-1 text-slate-300" id="optionsVolume">15.2K</p>
                <p class="text-xs text-slate-500 mt-2">Total volume</p>
            </div>
        </div>

        <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-6 mb-6">
            <div class="flex justify-between items-center mb-4 flex-wrap gap-3">
                <h3 class="text-lg md:text-xl font-semibold" id="chartTitle">IREN - Price and Social Correlation</h3>
                <div class="flex gap-2 flex-wrap">
                    <button onclick="changeTimeframe('1D')" class="time-btn px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs" data-time="1D">1D</button>
                    <button onclick="changeTimeframe('1W')" class="time-btn active px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs" data-time="1W">1W</button>
                    <button onclick="changeTimeframe('1M')" class="time-btn px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs" data-time="1M">1M</button>
                    <button onclick="changeTimeframe('3M')" class="time-btn px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs" data-time="3M">3M</button>
                    <button onclick="changeTimeframe('6M')" class="time-btn px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs" data-time="6M">6M</button>
                    <button onclick="changeTimeframe('1Y')" class="time-btn px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs" data-time="1Y">1Y</button>
                    <button onclick="changeTimeframe('2Y')" class="time-btn px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs" data-time="2Y">2Y</button>
                    <button onclick="changeTimeframe('3Y')" class="time-btn px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs" data-time="3Y">3Y</button>
                </div>
            </div>
            <div class="h-64 md:h-80">
                <canvas id="correlationChart"></canvas>
            </div>
            <div class="mt-3 flex justify-between items-center text-xs text-slate-400 flex-wrap gap-2">
                <p id="chartInfo">Showing 1 week correlation pattern</p>
                <p id="correlationStat">Correlation: <span class="text-blue-400 font-semibold" id="corrValue">+0.78</span> (Strong Positive)</p>
            </div>
        </div>

        <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-6 mb-6">
            <h3 class="text-lg md:text-xl font-semibold mb-4">Live Alerts</h3>
            <div id="alertsContainer" class="space-y-3"></div>
        </div>

        <div class="bg-slate-800 border border-blue-600 rounded-lg p-4 md:p-6 mb-6">
            <h3 class="text-lg md:text-xl font-bold mb-4 text-blue-400">API Setup</h3>
            <div class="space-y-4 text-sm">
                <div class="bg-green-900/30 border border-green-700 p-4 rounded">
                    <p class="font-bold mb-2 text-green-400">Ready to Use!</p>
                    <p class="text-slate-300 mb-2">Yahoo Finance provides: Stock prices, company info, 52-week ranges, earnings dates, and options data - all free!</p>
                    <p class="text-xs text-slate-400">Historical correlation data is simulated based on typical market patterns.</p>
                </div>

                <div class="bg-slate-900 p-4 rounded border border-slate-700">
                    <p class="font-bold mb-2 text-yellow-400">Optional: Add Alpha Vantage Key (Line 380)</p>
                    <pre class="bg-black p-3 rounded text-green-400 text-xs overflow-x-auto">const ALPHA_VANTAGE_KEY = 'YOUR_KEY_HERE';</pre>
                    <a href="https://www.alphavantage.co/support/#api-key" target="_blank" class="text-blue-400 hover:underline text-xs mt-2 inline-block">
                        Get Free Alpha Vantage Key
                    </a>
                </div>
            </div>
        </div>

        <div class="text-center text-slate-500 text-sm mb-4">
            <p>Social mentions use demo data. Stock prices and options are live from Yahoo Finance.</p>
            <p class="mt-2 text-xs">Not financial advice - For educational purposes only</p>
        </div>
    </div>

    <script>
        const ALPHA_VANTAGE_KEY = 'YOUR_ALPHA_VANTAGE_KEY_HERE';

        var currentSymbol = 'IREN';
        var currentTimeframe = '1W';
        var chartInstance = null;
        var isLiveMode = false;
        var currentPrice = 64.14;

        var companyInfo = {
            IREN: { name: 'IREN Limited', sector: 'Technology', high52: 70.05, low52: 5.17, ytd: 487, earnings: 'Dec 2, 2025', marketCap: 16.2 },
            TSLA: { name: 'Tesla Inc', sector: 'Automotive', high52: 299.29, low52: 138.80, ytd: 45, earnings: 'Jan 23, 2026', marketCap: 782.5 },
            NVDA: { name: 'NVIDIA Corporation', sector: 'Semiconductors', high52: 152.89, low52: 39.23, ytd: 195, earnings: 'Nov 20, 2025', marketCap: 3400.0 },
            AAPL: { name: 'Apple Inc', sector: 'Technology', high52: 199.62, low52: 164.08, ytd: 12, earnings: 'Jan 30, 2026', marketCap: 2800.0 },
            GME: { name: 'GameStop Corp', sector: 'Retail', high52: 64.83, low52: 9.95, ytd: 78, earnings: 'Dec 10, 2025', marketCap: 9.8 },
            AMC: { name: 'AMC Entertainment', sector: 'Entertainment', high52: 11.88, low52: 2.38, ytd: -12, earnings: 'Nov 8, 2025', marketCap: 1.2 },
            SPY: { name: 'SPDR S&P 500 ETF', sector: 'ETF', high52: 598.88, low52: 480.13, ytd: 24, earnings: 'N/A', marketCap: 0 },
            QQQ: { name: 'Invesco QQQ Trust', sector: 'ETF', high52: 512.52, low52: 390.33, ytd: 28, earnings: 'N/A', marketCap: 0 }
        };

        var socialDemo = {
            IREN: { social: 107, socialTrend: 'Rising' },
            TSLA: { social: 245, socialTrend: 'Very High' },
            NVDA: { social: 189, socialTrend: 'High' },
            AAPL: { social: 156, socialTrend: 'Moderate' },
            GME: { social: 312, socialTrend: 'Extreme' },
            AMC: { social: 203, socialTrend: 'High' },
            PLTR: { social: 145, socialTrend: 'Rising' },
            SPY: { social: 421, socialTrend: 'Very High' },
            QQQ: { social: 278, socialTrend: 'High' }
        };

        var defaultSocial = { social: 45, socialTrend: 'Low' };

        var timeframes = {
            '1D': { points: 8, labels: ['9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:30', '16:00'], desc: 'today', volatility: 1.5 },
            '1W': { points: 7, labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'], desc: '1 week', volatility: 3 },
            '1M': { points: 20, labels: generateDateLabels(20, 'day'), desc: '1 month', volatility: 5 },
            '3M': { points: 60, labels: generateDateLabels(60, 'day'), desc: '3 months', volatility: 8 },
            '6M': { points: 26, labels: generateDateLabels(26, 'week'), desc: '6 months', volatility: 12 },
            '1Y': { points: 52, labels: generateDateLabels(52, 'week'), desc: '1 year', volatility: 18 },
            '2Y': { points: 104, labels: generateDateLabels(104, 'week'), desc: '2 years', volatility: 25 },
            '3Y': { points: 156, labels: generateDateLabels(156, 'week'), desc: '3 years', volatility: 35 }
        };

        function generateDateLabels(count, type) {
            var labels = [];
            var now = new Date();
            for (var i = count - 1; i >= 0; i--) {
                var date = new Date(now);
                if (type === 'day') {
                    date.setDate(date.getDate() - i);
                    labels.push((date.getMonth() + 1) + '/' + date.getDate());
                } else if (type === 'week') {
                    date.setDate(date.getDate() - (i * 7));
                    labels.push((date.getMonth() + 1) + '/' + date.getDate());
                }
            }
            return labels;
        }

        window.onload = function() {
            initChart();
            updateDashboard(currentSymbol);
            updateTime();
            setInterval(updateTime, 1000);
            checkApiKey();
        };

        function checkApiKey() {
            if (ALPHA_VANTAGE_KEY !== 'YOUR_ALPHA_VANTAGE_KEY_HERE') {
                isLiveMode = true;
                document.getElementById('dataStatus').textContent = 'Live data enabled';
                document.getElementById('dataStatus').className = 'text-xs text-green-400 mt-1';
            }
        }

        function initChart() {
            var ctx = document.getElementById('correlationChart').getContext('2d');
            var config = timeframes[currentTimeframe];
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: config.labels,
                    datasets: [{
                        label: 'Price ($)',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        yAxisID: 'y',
                        tension: 0.4,
                        fill: true,
                        pointRadius: config.points > 50 ? 0 : 3
                    }, {
                        label: 'Social Mentions',
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        yAxisID: 'y1',
                        tension: 0.4,
                        fill: true,
                        pointRadius: config.points > 50 ? 0 : 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { 
                            labels: { color: '#94a3b8', font: { size: 11 } }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return currentSymbol + ' - ' + context[0].label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            ticks: { 
                                color: '#94a3b8', 
                                font: { size: 10 },
                                callback: function(value) { return '$' + value.toFixed(0); }
                            },
                            grid: { color: '#334155' },
                            title: {
                                display: true,
                                text: 'Stock Price',
                                color: '#10b981',
                                font: { size: 11 }
                            }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            ticks: { 
                                color: '#94a3b8', 
                                font: { size: 10 }
                            },
                            grid: { display: false },
                            title: {
                                display: true,
                                text: 'Social Mentions',
                                color: '#3b82f6',
                                font: { size: 11 }
                            }
                        },
                        x: {
                            ticks: { 
                                color: '#94a3b8', 
                                font: { size: 9 },
                                maxRotation: 45,
                                minRotation: 0,
                                maxTicksLimit: config.points > 50 ? 12 : config.points
                            },
                            grid: { color: '#334155' }
                        }
                    }
                }
            });
            updateChart(currentSymbol);
        }

        function changeTimeframe(tf) {
            currentTimeframe = tf;
            
            document.querySelectorAll('.time-btn').forEach(function(btn) {
                btn.classList.remove('active');
            });
            document.querySelector('[data-time="' + tf + '"]').classList.add('active');
            
            var config = timeframes[tf];
            chartInstance.data.labels = config.labels;
            chartInstance.options.scales.x.ticks.maxTicksLimit = config.points > 50 ? 12 : config.points;
            chartInstance.data.datasets[0].pointRadius = config.points > 50 ? 0 : 3;
            chartInstance.data.datasets[1].pointRadius = config.points > 50 ? 0 : 3;
            
            document.getElementById('chartInfo').textContent = 'Showing ' + config.desc + ' correlation pattern for ' + currentSymbol;
            updateChart(currentSymbol);
        }

        function generateHistoricalData(basePrice, baseSocial, timeframe) {
            var config = timeframes[timeframe];
            var priceData = [];
            var socialData = [];
            var correlation = 0.75 + (Math.random() * 0.2);
            
            var startPrice = basePrice;
            var startSocial = baseSocial;
            
            if (timeframe !== '1D') {
                var priceMultiplier = 1;
                if (timeframe === '1W') priceMultiplier = 0.95;
                else if (timeframe === '1M') priceMultiplier = 0.88;
                else if (timeframe === '3M') priceMultiplier = 0.75;
                else if (timeframe === '6M') priceMultiplier = 0.60;
                else if (timeframe === '1Y') priceMultiplier = 0.45;
                else if (timeframe === '2Y') priceMultiplier = 0.30;
                else if (timeframe === '3Y') priceMultiplier = 0.20;
                
                startPrice = basePrice * priceMultiplier;
                startSocial = baseSocial * (0.6 + Math.random() * 0.4);
            }
            
            var currentPricePoint = startPrice;
            var currentSocialPoint = startSocial;
            var trend = (basePrice - startPrice) / config.points;
            var socialTrend = (baseSocial - startSocial) / config.points;
            
            for (var i = 0; i < config.points; i++) {
                var priceNoise = (Math.random() - 0.5) * config.volatility;
                var socialNoise = (Math.random() - 0.5) * (baseSocial * 0.1);
                
                currentPricePoint += trend + priceNoise;
                currentSocialPoint += socialTrend + socialNoise + (priceNoise * correlation * 2);
                
                priceData.push(Math.max(currentPricePoint, startPrice * 0.5));
                socialData.push(Math.max(Math.min(currentSocialPoint, baseSocial * 2), baseSocial * 0.3));
            }
            
            priceData[priceData.length - 1] = basePrice;
            socialData[socialData.length - 1] = baseSocial;
            
            var corrStrength = correlation > 0.85 ? 'Very Strong' : correlation > 0.70 ? 'Strong' : correlation > 0.50 ? 'Moderate' : 'Weak';
            document.getElementById('corrValue').textContent = '+' + correlation.toFixed(2);
            document.getElementById('correlationStat').innerHTML = 'Correlation: <span class="text-blue-400 font-semibold">+' + correlation.toFixed(2) + '</span> (' + corrStrength + ' Positive)';
            
            return { priceData: priceData, socialData: socialData };
        }

        async function fetchYahooQuote(symbol) {
            try {
                var url = 'https://query2.finance.yahoo.com/v10/finance/quoteSummary/' + symbol + '?modules=price,summaryDetail,defaultKeyStatistics,calendarEvents';
                var response = await fetch(url);
                var data = await response.json();
                
                if (data.quoteSummary && data.quoteSummary.result && data.quoteSummary.result[0]) {
                    var result = data.quoteSummary.result[0];
                    var price = result.price;
                    var summary = result.summaryDetail;
                    var calendar = result.calendarEvents;
                    
                    return {
                        price: price.regularMarketPrice.raw,
                        change: price.regularMarketChange.raw,
                        changePercent: price.regularMarketChangePercent.raw * 100,
                        volume: price.regularMarketVolume.raw,
                        high52: summary.fiftyTwoWeekHigh.raw,
                        low52: summary.fiftyTwoWeekLow.raw,
                        marketCap: price.marketCap.raw / 1000000000,
                        name: price.longName || price.shortName,
                        earnings: calendar && calendar.earnings && calendar.earnings.earningsDate ? calendar.earnings.earningsDate[0].fmt : 'N/A'
                    };
                }
                return null;
            } catch (error) {
                console.error('Error fetching Yahoo quote:', error);
                return null;
            }
        }

        async function fetchOptionsData(symbol) {
            try {
                var url = 'https://query2.finance.yahoo.com/v7/finance/options/' + symbol;
                var response = await fetch(url);
                var data = await response.json();
                
                if (data.optionChain && data.optionChain.result && data.optionChain.result[0]) {
                    var options = data.optionChain.result[0].options[0];
                    var calls = options.calls || [];
                    var puts = options.puts || [];
                    
                    var callVolume = calls.reduce(function(sum, opt) { return sum + (opt.volume || 0); }, 0);
                    var putVolume = puts.reduce(function(sum, opt) { return sum + (opt.volume || 0); }, 0);
                    var totalVolume = callVolume + putVolume;
                    var putCallRatio = callVolume > 0 ? (putVolume / callVolume).toFixed(2) : 0;
                    
                    return {
                        putCall: parseFloat(putCallRatio),
                        optionsSentiment: putCallRatio < 0.8 ? 'Bullish' : putCallRatio > 1.2 ? 'Bearish' : 'Neutral',
                        optionsVolume: (totalVolume / 1000).toFixed(1) + 'K',
                        unusualActivity: totalVolume > 50000 ? 'Very High' : totalVolume > 25000 ? 'High' : 'Moderate'
                    };
                }
                return null;
            } catch (error) {
                console.error('Error fetching options data:', error);
                return null;
            }
        }

        async function updateDashboard(symbol) {
            var socialData = socialDemo[symbol] || defaultSocial;
            var compData = companyInfo[symbol] || { name: symbol, sector: 'Unknown', high52: 0, low52: 0, ytd: 0, earnings: 'N/A', marketCap: 0 };
            
            var data = {
                
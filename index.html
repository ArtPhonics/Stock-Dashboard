<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Correlation Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <div class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold mb-2">Stock Correlation Dashboard</h1>
            <p class="text-slate-300 text-sm md:text-base">Real-time Social, Options, and Price Analysis</p>
        </div>

        <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-6 mb-6">
            <div class="flex gap-3 md:gap-4 items-end flex-wrap">
                <div class="flex-1 min-w-48">
                    <label class="block text-sm font-semibold mb-2">Stock Symbol</label>
                    <input 
                        type="text"
                        id="symbolInput"
                        placeholder="Enter symbol (IREN, TSLA, NVDA)"
                        class="w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-blue-500"
                        value="IREN"
                    />
                </div>
                <button onclick="searchSymbol()" class="px-6 md:px-8 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-all">
                    Analyze
                </button>
                <button onclick="refreshData()" id="refreshBtn" class="px-6 md:px-8 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition-all flex items-center gap-2">
                    <span id="refreshIcon">üîÑ</span>
                    <span class="hidden md:inline">Refresh</span>
                </button>
            </div>
        </div>

        <div class="bg-gradient-to-r from-blue-900 to-purple-900 border-2 border-blue-700 rounded-lg p-4 md:p-6 mb-6">
            <div class="flex justify-between items-center flex-wrap gap-4">
                <div>
                    <p class="text-xs md:text-sm opacity-90 mb-1">NOW ANALYZING</p>
                    <p class="text-3xl md:text-4xl font-bold" id="currentSymbol">IREN</p>
                    <p class="text-xs md:text-sm opacity-90 mt-2" id="lastUpdate">Loading...</p>
                    <p class="text-xs opacity-75 mt-1" id="dataStatus">Using demo data</p>
                </div>
                <div class="text-right">
                    <p class="text-4xl md:text-6xl font-bold opacity-50" id="signalScore">75</p>
                    <p class="text-xs md:text-sm opacity-90">Score</p>
                    <p class="text-base md:text-lg font-bold mt-2" id="signalStrength">MODERATE BUY</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-5">
                <p class="text-xs md:text-sm text-slate-400 mb-2">Stock Price</p>
                <p class="text-2xl md:text-3xl font-bold" id="price">$64.14</p>
                <p class="text-sm mt-1 text-green-400" id="priceChange">+4.37 (+7.31%)</p>
                <p class="text-xs text-slate-500 mt-2" id="volume">Vol: 47.0M</p>
            </div>

            <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-5">
                <p class="text-xs md:text-sm text-slate-400 mb-2">Social Mentions</p>
                <p class="text-2xl md:text-3xl font-bold text-blue-400" id="socialMentions">107</p>
                <p class="text-sm mt-1 text-blue-300" id="socialTrend">Rising</p>
                <p class="text-xs text-slate-500 mt-2">Reddit + Twitter</p>
            </div>

            <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-5">
                <p class="text-xs md:text-sm text-slate-400 mb-2">Put/Call Ratio</p>
                <p class="text-2xl md:text-3xl font-bold text-purple-400" id="putCallRatio">0.86</p>
                <p class="text-sm mt-1 text-green-400" id="optionsSentiment">Bullish</p>
                <p class="text-xs text-slate-500 mt-2">Below 1.0 is bullish</p>
            </div>

            <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-5">
                <p class="text-xs md:text-sm text-slate-400 mb-2">Options Activity</p>
                <p class="text-2xl md:text-3xl font-bold text-yellow-400" id="unusualActivity">Moderate</p>
                <p class="text-sm mt-1 text-slate-300" id="optionsVolume">15.2K</p>
                <p class="text-xs text-slate-500 mt-2">Total volume</p>
            </div>
        </div>

        <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-6 mb-6">
            <h3 class="text-lg md:text-xl font-semibold mb-4">Price and Social Correlation</h3>
            <div class="h-64 md:h-80">
                <canvas id="correlationChart"></canvas>
            </div>
        </div>

        <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 md:p-6 mb-6">
            <h3 class="text-lg md:text-xl font-semibold mb-4">Live Alerts</h3>
            <div id="alertsContainer" class="space-y-3"></div>
        </div>

        <div class="bg-slate-800 border border-blue-600 rounded-lg p-4 md:p-6 mb-6">
            <h3 class="text-lg md:text-xl font-bold mb-4 text-blue-400">üîå API Setup (Canada-Friendly)</h3>
            <div class="space-y-4 text-sm">
                <div class="bg-green-900/30 border border-green-700 p-4 rounded">
                    <p class="font-bold mb-2 text-green-400">‚úÖ Ready to Use!</p>
                    <p class="text-slate-300 mb-2">This version uses Yahoo Finance - no API keys needed for options data!</p>
                    <p class="text-xs text-slate-400">Just add your Alpha Vantage key below for live stock prices.</p>
                </div>

                <div class="bg-slate-900 p-4 rounded border border-slate-700">
                    <p class="font-bold mb-2 text-yellow-400">üìç Add Your Alpha Vantage Key (Line 290)</p>
                    <pre class="bg-black p-3 rounded text-green-400 text-xs overflow-x-auto">const ALPHA_VANTAGE_KEY = 'YOUR_KEY_HERE';</pre>
                    <a href="https://www.alphavantage.co/support/#api-key" target="_blank" class="text-blue-400 hover:underline text-xs mt-2 inline-block">
                        Get Free Alpha Vantage Key ‚Üí
                    </a>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-900 p-4 rounded border border-slate-700">
                        <p class="font-bold text-green-400 mb-2">üìà Stock Prices</p>
                        <p class="mb-2 font-semibold">Alpha Vantage</p>
                        <ul class="text-xs space-y-1 text-slate-300 mb-3">
                            <li>‚Ä¢ Free tier available</li>
                            <li>‚Ä¢ Works in Canada ‚úÖ</li>
                            <li>‚Ä¢ 5 calls per minute</li>
                        </ul>
                        <p class="text-xs text-yellow-300">‚ö†Ô∏è Required for live prices</p>
                    </div>

                    <div class="bg-slate-900 p-4 rounded border border-slate-700">
                        <p class="font-bold text-purple-400 mb-2">üìä Options Data</p>
                        <p class="mb-2 font-semibold">Yahoo Finance</p>
                        <ul class="text-xs space-y-1 text-slate-300 mb-3">
                            <li>‚Ä¢ No API key needed ‚úÖ</li>
                            <li>‚Ä¢ Works worldwide ‚úÖ</li>
                            <li>‚Ä¢ Already integrated!</li>
                        </ul>
                        <p class="text-xs text-green-300">‚úÖ Already working!</p>
                    </div>
                </div>

                <div class="bg-blue-900/30 border border-blue-700 p-4 rounded">
                    <p class="font-bold mb-2">üöÄ How to Activate:</p>
                    <ol class="text-xs space-y-2 text-slate-300 list-decimal list-inside">
                        <li>Get your free Alpha Vantage key (click link above)</li>
                        <li>Open index.html in a text editor</li>
                        <li>Find line 290 and add your key</li>
                        <li>Save and re-upload to GitHub Pages</li>
                        <li>Refresh your live site - done!</li>
                    </ol>
                </div>
            </div>
        </div>

        <div class="text-center text-slate-500 text-sm mb-4">
            <p>‚ö†Ô∏è Demo data shown until you add your Alpha Vantage key</p>
            <p class="mt-2 text-xs">Not financial advice ‚Ä¢ For educational purposes only</p>
        </div>
    </div>

    <script>
        // ====================================
        // üîë ADD YOUR ALPHA VANTAGE KEY HERE
        // ====================================
        const ALPHA_VANTAGE_KEY = 'YOUR_ALPHA_VANTAGE_KEY_HERE';

        // Current state
        var currentSymbol = 'IREN';
        var chartInstance = null;
        var isLiveMode = false;

        // Demo data
        var demoData = {
            IREN: { social: 107, socialTrend: 'Rising' },
            TSLA: { social: 245, socialTrend: 'High' },
            NVDA: { social: 189, socialTrend: 'Stable' },
            AAPL: { social: 156, socialTrend: 'Moderate' },
            GME: { social: 312, socialTrend: 'Very High' },
            AMC: { social: 203, socialTrend: 'High' },
            PLTR: { social: 145, socialTrend: 'Rising' },
            COIN: { social: 98, socialTrend: 'Moderate' },
            HOOD: { social: 87, socialTrend: 'Moderate' },
            SPY: { social: 421, socialTrend: 'Very High' },
            QQQ: { social: 278, socialTrend: 'High' }
        };
        
        // Default values for unknown symbols
        var defaultSocial = {
            social: 45,
            socialTrend: 'Low'
        };

        // Initialize
        window.onload = function() {
            initChart();
            updateDashboard(currentSymbol);
            updateTime();
            setInterval(updateTime, 1000);
            checkApiKey();
        };

        // Check if API key is configured
        function checkApiKey() {
            if (ALPHA_VANTAGE_KEY !== 'YOUR_ALPHA_VANTAGE_KEY_HERE') {
                isLiveMode = true;
                document.getElementById('dataStatus').textContent = 'Live data enabled';
                document.getElementById('dataStatus').className = 'text-xs text-green-400 mt-1';
            }
        }

        // Initialize chart
        function initChart() {
            var ctx = document.getElementById('correlationChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00'],
                    datasets: [{
                        label: 'Price ($)',
                        data: [63.5, 64.2, 65.8, 67.1, 66.5, 64.1, 65.3, 64.8],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        yAxisID: 'y',
                        tension: 0.4
                    }, {
                        label: 'Social Mentions',
                        data: [85, 92, 98, 105, 107, 110, 115, 118],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        yAxisID: 'y1',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { 
                            labels: { color: '#94a3b8', font: { size: 11 } }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            ticks: { color: '#94a3b8', font: { size: 10 } },
                            grid: { color: '#334155' }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            ticks: { color: '#94a3b8', font: { size: 10 } },
                            grid: { display: false }
                        },
                        x: {
                            ticks: { color: '#94a3b8', font: { size: 10 } },
                            grid: { color: '#334155' }
                        }
                    }
                }
            });
        }

        // Fetch live stock price from Alpha Vantage
        async function fetchStockPrice(symbol) {
            if (!isLiveMode) return null;

            try {
                var url = 'https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=' + symbol + '&apikey=' + ALPHA_VANTAGE_KEY;
                var response = await fetch(url);
                var data = await response.json();
                
                if (data['Global Quote']) {
                    var quote = data['Global Quote'];
                    return {
                        price: parseFloat(quote['05. price']),
                        change: parseFloat(quote['09. change']),
                        changePercent: parseFloat(quote['10. change percent'].replace('%', '')),
                        volume: parseInt(quote['06. volume'])
                    };
                }
                return null;
            } catch (error) {
                console.error('Error fetching stock price:', error);
                return null;
            }
        }

        // Fetch options data from Yahoo Finance
        async function fetchOptionsData(symbol) {
            try {
                var url = 'https://query2.finance.yahoo.com/v7/finance/options/' + symbol;
                var response = await fetch(url);
                var data = await response.json();
                
                if (data.optionChain && data.optionChain.result && data.optionChain.result[0]) {
                    var options = data.optionChain.result[0].options[0];
                    var calls = options.calls || [];
                    var puts = options.puts || [];
                    
                    var callVolume = calls.reduce(function(sum, opt) { return sum + (opt.volume || 0); }, 0);
                    var putVolume = puts.reduce(function(sum, opt) { return sum + (opt.volume || 0); }, 0);
                    var totalVolume = callVolume + putVolume;
                    var putCallRatio = callVolume > 0 ? (putVolume / callVolume).toFixed(2) : 0;
                    
                    return {
                        putCall: parseFloat(putCallRatio),
                        optionsSentiment: putCallRatio < 0.8 ? 'Bullish' : putCallRatio > 1.2 ? 'Bearish' : 'Neutral',
                        optionsVolume: (totalVolume / 1000).toFixed(1) + 'K',
                        unusualActivity: totalVolume > 50000 ? 'Very High' : totalVolume > 25000 ? 'High' : 'Moderate'
                    };
                }
                return null;
            } catch (error) {
                console.error('Error fetching options data:', error);
                return null;
            }
        }

        // Update dashboard
        async function updateDashboard(symbol) {
            // Get social data from demo (or default)
            var socialData = demoData[symbol] || defaultSocial;
            
            // Initialize with defaults
            var data = {
                price: 0,
                change: 0,
                changePercent: 0,
                volume: 0,
                social: socialData.social,
                socialTrend: socialData.socialTrend,
                putCall: 0.95,
                optionsSentiment: 'Neutral',
                optionsVolume: '0K',
                unusualActivity: 'Low'
            };
            
            // Try to fetch live data
            document.getElementById('dataStatus').textContent = 'Fetching live data...';
            document.getElementById('dataStatus').className = 'text-xs text-yellow-400 mt-1';
            
            var priceData = await fetchStockPrice(symbol);
            var optionsData = await fetchOptionsData(symbol);
            
            if (priceData) {
                data.price = priceData.price;
                data.change = priceData.change;
                data.changePercent = priceData.changePercent;
                data.volume = priceData.volume;
                document.getElementById('dataStatus').textContent = 'Live stock data loaded';
                document.getElementById('dataStatus').className = 'text-xs text-green-400 mt-1';
            } else if (!isLiveMode) {
                document.getElementById('dataStatus').textContent = 'Add Alpha Vantage key for live prices';
                document.getElementById('dataStatus').className = 'text-xs text-yellow-400 mt-1';
            } else {
                document.getElementById('dataStatus').textContent = 'Error loading price data';
                document.getElementById('dataStatus').className = 'text-xs text-red-400 mt-1';
            }
            
            if (optionsData) {
                data.putCall = optionsData.putCall;
                data.optionsSentiment = optionsData.optionsSentiment;
                data.optionsVolume = optionsData.optionsVolume;
                data.unusualActivity = optionsData.unusualActivity;
            }
            
            document.getElementById('currentSymbol').textContent = symbol;
            
            var score = calculateScore(data);
            document.getElementById('signalScore').textContent = score;
            
            var signal = getSignal(score);
            document.getElementById('signalStrength').textContent = signal.text;
            document.getElementById('signalStrength').className = 'text-base md:text-lg font-bold mt-2 ' + signal.color;
            
            document.getElementById('price').textContent = '$' + data.price.toFixed(2);
            var changeColor = data.change >= 0 ? 'text-green-400' : 'text-red-400';
            var changeSign = data.change >= 0 ? '+' : '';
            document.getElementById('priceChange').textContent = changeSign + data.change.toFixed(2) + ' (' + changeSign + data.changePercent.toFixed(2) + '%)';
            document.getElementById('priceChange').className = 'text-sm mt-1 ' + changeColor;
            document.getElementById('volume').textContent = 'Vol: ' + (data.volume / 1000000).toFixed(1) + 'M';
            
            document.getElementById('socialMentions').textContent = data.social;
            document.getElementById('socialTrend').textContent = data.socialTrend;
            document.getElementById('putCallRatio').textContent = data.putCall;
            document.getElementById('optionsSentiment').textContent = data.optionsSentiment;
            document.getElementById('unusualActivity').textContent = data.unusualActivity;
            document.getElementById('optionsVolume').textContent = data.optionsVolume + ' contracts';
            
            updateAlerts(symbol, data);
        }

        function calculateScore(data) {
            var score = 50;
            if (data.changePercent > 5) score += 20;
            else if (data.changePercent > 2) score += 10;
            else if (data.changePercent < -5) score -= 20;
            else if (data.changePercent < -2) score -= 10;
            if (data.social > 150) score += 15;
            else if (data.social > 100) score += 10;
            else if (data.social > 50) score += 5;
            if (data.putCall < 0.8) score += 15;
            else if (data.putCall < 1.0) score += 10;
            else if (data.putCall > 1.5) score -= 15;
            else if (data.putCall > 1.2) score -= 10;
            return Math.max(0, Math.min(100, score));
        }

        function getSignal(score) {
            if (score >= 80) return { text: 'STRONG BUY', color: 'text-green-400' };
            if (score >= 65) return { text: 'MODERATE BUY', color: 'text-blue-400' };
            if (score >= 45) return { text: 'NEUTRAL', color: 'text-yellow-400' };
            if (score >= 30) return { text: 'CAUTION', color: 'text-orange-400' };
            return { text: 'BEARISH', color: 'text-red-400' };
        }

        function updateAlerts(symbol, data) {
            var alerts = [];
            if (data.social > 100) {
                alerts.push({ type: 'social', msg: symbol + ' trending with ' + data.social + ' mentions', time: 'Now' });
            }
            if (data.unusualActivity === 'Very High' || data.unusualActivity === 'High') {
                alerts.push({ type: 'options', msg: 'Unusual options: ' + data.optionsVolume, time: '5m ago' });
            }
            if (Math.abs(data.changePercent) > 5) {
                alerts.push({ type: 'price', msg: symbol + ' moved ' + Math.abs(data.changePercent).toFixed(2) + '%', time: '10m ago' });
            }
            
            var html = '';
            for (var i = 0; i < alerts.length; i++) {
                var alert = alerts[i];
                var bg = alert.type === 'social' ? 'bg-blue-900/40 border border-blue-700' : 
                         alert.type === 'options' ? 'bg-purple-900/40 border border-purple-700' : 
                         'bg-green-900/40 border border-green-700';
                html += '<div class="p-3 rounded ' + bg + '">';
                html += '<p class="text-sm font-semibold">' + alert.msg + '</p>';
                html += '<p class="text-xs text-slate-400 mt-1">' + alert.time + '</p>';
                html += '</div>';
            }
            document.getElementById('alertsContainer').innerHTML = html || '<p class="text-slate-500 text-sm">No alerts at this time</p>';
        }

        function searchSymbol() {
            var input = document.getElementById('symbolInput');
            var symbol = input.value.toUpperCase().trim();
            if (!symbol) {
                alert('Please enter a stock symbol');
                return;
            }
            currentSymbol = symbol;
            updateDashboard(symbol);
            updateChart(symbol);
        }

        function refreshData() {
            var btn = document.getElementById('refreshBtn');
            var icon = document.getElementById('refreshIcon');
            btn.disabled = true;
            icon.classList.add('animate-spin');
            
            setTimeout(function() {
                updateDashboard(currentSymbol);
                updateChart(currentSymbol);
                btn.disabled = false;
                icon.classList.remove('animate-spin');
            }, 1500);
        }

        function updateChart(symbol) {
            var socialInfo = demoData[symbol] || defaultSocial;
            var basePrice = 100;
            var baseSocial = socialInfo.social;
            var priceData = [];
            var socialChartData = [];
            for (var i = 0; i < 8; i++) {
                priceData.push(basePrice + (Math.random() - 0.5) * 10);
                socialChartData.push(baseSocial + Math.floor((Math.random() - 0.3) * 20));
            }
            chartInstance.data.datasets[0].data = priceData;
            chartInstance.data.datasets[1].data = socialChartData;
            chartInstance.update('none');
        }

        function updateTime() {
            var now = new Date();
            document.getElementById('lastUpdate').textContent = 'Updated: ' + now.toLocaleTimeString();
        }

        document.getElementById('symbolInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchSymbol();
        });
    </script>
</body>
</html>